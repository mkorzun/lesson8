---
- hosts: build
  gather_facts: no
  become: yes

  tasks:
  - name: Upload dockerfile to build host
    synchronize: src=dockerfiles/build dest=/tmp
  - name: Install docker and some dependencies
    apt:
     name: python3-pip, docker.io
     state: present
     update_cache: yes
  - name: Start docker service
    service:
     name: docker
     state: started
  - name: Install docker python module
    pip:
     name: docker

- hosts: build
  gather_facts: no
  become: yes
  tasks:
  - name: Build container image
    docker_image:
     name: build_boxfuse
     build:
     path: /tmp/build
     state: present
  - name: Start docker container
    docker_container:
     name: build_boxfuse
     image: build_boxfuse
     auto_remove: yes
     state: started
  - name: Remove image
    docker_image:
     state: absent
     name: build_boxfuse




















